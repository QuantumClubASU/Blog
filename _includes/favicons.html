<!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->

{% if site.gravatar_hash %}
  <script>
    const gravatarHash = '{{ site.gravatar_hash }}';
    const gravatarURL = `https://www.gravatar.com/avatar/${gravatarHash}?s=64&d=identicon`;

    function setCircularFavicon(imageUrl) {
      const img = new Image();
      img.crossOrigin = 'anonymous';

      img.onload = function () {
        const size = 64;
        const canvas = document.createElement('canvas');
        canvas.width = canvas.height = size;
        const ctx = canvas.getContext('2d');

        ctx.beginPath();
        ctx.arc(size / 2, size / 2, size / 2, 0, Math.PI * 2);
        ctx.closePath();
        ctx.clip();

        ctx.drawImage(img, 0, 0, size, size);

        let favicon = document.querySelector('link[rel="icon"]');
        if (!favicon) {
          favicon = document.createElement('link');
          favicon.rel = 'icon';
          document.head.appendChild(favicon);
        }
        favicon.href = canvas.toDataURL('image/png');
      };

      img.onerror = function () {
        console.error('Failed to load Gravatar image.');
      };

      img.src = imageUrl;
    }

    setCircularFavicon(gravatarURL);
  </script>
{% else %}
  {% capture favicon_path %}{{ '/assets/img/favicons' | relative_url }}{% endcapture %}

  <link rel="apple-touch-icon" sizes="180x180" href="{{ favicon_path }}/apple-touch-icon.png">
  {% comment %}
    <link rel="icon" type="image/png" sizes="32x32" id="favicon" href="{{ favicon_path }}/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" id="favicon" href="{{ favicon_path }}/favicon-16x16.png">
  {% endcomment %}
  {% if site.pwa.enabled %}
    <link rel="manifest" href="{{ favicon_path }}/site.webmanifest">
  {% endif %}
  <link rel="shortcut icon" href="{{ favicon_path }}/favicon.ico">
  <meta name="apple-mobile-web-app-title" content="{{ site.title }}">
  <meta name="application-name" content="{{ site.title }}">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="msapplication-config" content="{{ favicon_path }}/browserconfig.xml">
  <meta name="theme-color" content="#ffffff">
{% endif %}
